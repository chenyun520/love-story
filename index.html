<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OUR LOVE STORY - çºªå¿µæ‚å¿—</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Didot:wght@400;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/magazine.css">
    <link rel="stylesheet" href="css/auth.css">
    <style>
        /* Shake Animation for Login */
        .shake { animation: shake 0.5s; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Carousel Styles */
        .carousel-container {
            width: 100%;
            overflow: hidden;
            margin: 20px 0;
            white-space: nowrap;
            position: relative;
            mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
            -webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
        }

        .carousel-track {
            display: inline-block;
            animation: marquee 30s linear infinite;
        }

        .carousel-container:hover .carousel-track {
            animation-play-state: paused;
        }

        .carousel-container.carousel-paused .carousel-track {
            animation-play-state: paused;
        }

        .carousel-item {
            display: inline-block;
            width: clamp(120px, 16vw, 190px);
            height: clamp(170px, 22vw, 260px);
            margin: 0 8px;
            background-size: cover;
            background-position: center;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            vertical-align: middle;
        }

        .carousel-item:hover {
            transform: scale(1.05);
            z-index: 10;
        }

        @keyframes marquee {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .carousel-preview {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(20, 25, 35, 0.55);
            backdrop-filter: blur(10px);
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 260ms ease;
        }

        .carousel-preview.show {
            opacity: 1;
            pointer-events: auto;
        }

        .carousel-preview-inner {
            width: min(92vw, 1100px);
            height: min(84vh, 760px);
            border-radius: 18px;
            overflow: hidden;
            background: rgba(255,255,255,0.92);
            box-shadow: 0 30px 90px rgba(0,0,0,0.35);
            border: 1px solid rgba(255,255,255,0.45);
            transform: translateY(10px) scale(0.96);
            opacity: 0;
        }

        .carousel-preview.show .carousel-preview-inner {
            animation: previewPop 420ms cubic-bezier(0.2, 0.9, 0.2, 1) forwards;
        }

        @keyframes previewPop {
            0% { transform: translateY(14px) scale(0.94); opacity: 0; }
            60% { transform: translateY(0) scale(1.01); opacity: 1; }
            100% { transform: translateY(0) scale(1); opacity: 1; }
        }

        .carousel-preview-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            transform: scale(1.04);
            opacity: 0;
        }

        .carousel-preview.show .carousel-preview-img {
            animation: previewImg 520ms cubic-bezier(0.2, 0.9, 0.2, 1) forwards;
        }

        @keyframes previewImg {
            0% { transform: scale(1.08); opacity: 0; filter: blur(6px); }
            60% { transform: scale(1.01); opacity: 1; filter: blur(0); }
            100% { transform: scale(1); opacity: 1; filter: blur(0); }
        }

        /* Cover Image on Login */
        .login-cover-card {
            width: 100%;
            max-width: 520px;
            height: 520px;
            background-image: url('image/cover.png');
            background-size: cover;
            background-position: center;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            position: relative;
        }

        .login-cover-card::after {
            content: '';
            position: absolute;
            top:0; left:0; right:0; bottom:0;
            background: linear-gradient(to top, rgba(0,0,0,0.6), transparent);
            border-radius: 10px;
        }

        .login-cover-title {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: white;
            z-index: 2;
            text-align: left;
        }
    </style>
</head>
<body>

    <!-- SECTION 1: COVER & LOGIN -->
    <section id="loginSection" class="cover-layout">
        <!-- Decorative Background Elements -->
        <div class="bg-deco-circle" style="width: 600px; height: 600px; top: -100px; right: -100px;"></div>
        <div class="bg-deco-circle" style="width: 400px; height: 400px; bottom: -50px; left: -50px;"></div>

        <div class="cover-content fade-in login-split">
            <div class="login-split-left">
                <div class="login-cover-card">
                    <div class="login-cover-title">
                        <h2 style="margin:0; font-size: 2rem; font-family: 'Didot', serif;">OUR MEMORY</h2>
                        <p style="margin:5px 0 0; font-size: 0.9rem; opacity: 0.8;">Love Commemorative Magazine</p>
                    </div>
                </div>
            </div>

            <div class="login-split-right">
                <div id="loginTimer" style="width: 100%;"></div>

                <div class="login-form" style="width: 100%; margin-top: 20px;">
                    <p style="color: var(--text-light); margin-bottom: 5px;">è¯·é€‰æ‹©ç™»å½•æ–¹å¼</p>

                    <button id="btnAccountLogin" class="btn btn-primary" style="width: 100%; margin-bottom: 10px;">
                        ğŸ“ è´¦å·ç™»å½•/æ³¨å†Œ
                    </button>

                    <div style="text-align: center; margin: 15px 0; color: var(--text-light); font-size: 14px;">
                        â”€â”€â”€â”€ æˆ– â”€â”€â”€â”€
                    </div>

                    <div class="input-group">
                        <input type="password" id="passwordInput" placeholder="ç®¡ç†å‘˜å¯†ç  (å¯é€‰)" maxlength="6">
                    </div>

                    <div id="loginError" class="error-msg"></div>

                    <button id="btnLogin" class="btn btn-secondary" style="width: 100%; margin-top: 5px; font-size: 14px;">
                        ğŸ”‘ ç®¡ç†å‘˜ç™»å½•
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION 2: TABLE OF CONTENTS (Revealed after login) -->
    <section id="tocSection" class="toc-section hidden">
        <div class="toc-layout">
            <aside class="toc-side">
                <div class="carousel-container fade-in" style="margin: 0;">
                    <div class="carousel-track" id="carouselTrack">
                        <!-- Images injected via JS -->
                    </div>
                </div>
                <div id="homeTimer" style="max-width: 600px; width:100%;"></div>
            </aside>

            <div class="toc-main">
                <div class="toc-header fade-in">
                    <h2 class="toc-title">ç›®å½• CONTENTS</h2>
                    <p style="color: var(--text-light); letter-spacing: 2px; margin-top: 10px;">ISSUE 01: BEGINNING</p>
                </div>

                <div class="toc-grid fade-in" style="animation-delay: 0.2s;">

                    <a href="manga.html" class="toc-card">
                        <div class="card-img" style="background-image: url('image/cover.png'); background-color: #ffeef0;">
                            <div class="card-icon">ğŸ“–</div>
                        </div>
                        <div class="card-content">
                            <div>
                                <h3 class="card-title">æ¼«ç”»æ‹çˆ±å²</h3>
                                <p class="card-desc">ä»åˆè¯†åˆ°ç›¸çˆ±ï¼Œæ¯ä¸€ä¸ªå¿ƒåŠ¨ç¬é—´çš„æ¼«ç”»è®°å½•ã€‚</p>
                            </div>
                            <div class="card-footer">
                                READ STORY <span>â†’</span>
                            </div>
                        </div>
                    </a>

                    <a href="game.html" class="toc-card">
                        <div class="card-img" style="background-color: #f0f7ff;">
                            <div class="card-icon">ğŸ®</div>
                        </div>
                        <div class="card-content">
                            <div>
                                <h3 class="card-title">æ¸¸æˆç« èŠ‚</h3>
                                <p class="card-desc">åŒ…å«â€œå·¥å…·å½’ä½â€ä¸å…¨æ–°çš„â€œæ°´æœæ´¾å¯¹â€æŒ‘æˆ˜ã€‚</p>
                            </div>
                            <div class="card-footer">
                                PLAY NOW <span>â†’</span>
                            </div>
                        </div>
                    </a>

                    <a href="eat.html" class="toc-card">
                        <div class="card-img" style="background-image: url('image/ç¾Š (3).png'); background-color: #fff3e6;">
                            <div class="card-icon">ğŸ½ï¸</div>
                        </div>
                        <div class="card-content">
                            <div>
                                <h3 class="card-title">å°ç¾Šåƒä»€ä¹ˆ</h3>
                                <p class="card-desc">è¾“å…¥æ˜ŸæœŸã€å¤©æ°”å’Œå¿ƒæƒ…ï¼Œè®©å°ç¾Šæ™ºèƒ½æ¨èä»Šæ—¥èœå•ã€‚</p>
                            </div>
                            <div class="card-footer">
                                LET'S EAT <span>â†’</span>
                            </div>
                        </div>
                    </a>

                    <div class="toc-card" style="cursor: default;">
                        <div class="card-img" style="background-color: #f9f9f9;">
                            <div class="card-icon" style="color: #ccc;">ğŸš§</div>
                        </div>
                        <div class="card-content">
                            <div>
                                <h3 class="card-title">å¾…å¼€å‘</h3>
                                <p class="card-desc">æ›´å¤šç²¾å½©å†…å®¹æ­£åœ¨ç­–åˆ’ä¸­ï¼Œæ•¬è¯·æœŸå¾…...</p>
                            </div>
                            <div class="card-footer" style="color: #ccc;">
                                COMING SOON
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div id="carouselPreview" class="carousel-preview" aria-hidden="true">
            <div class="carousel-preview-inner">
                <img id="carouselPreviewImg" class="carousel-preview-img" alt="ç…§ç‰‡é¢„è§ˆ">
            </div>
        </div>
    </section>

    <script src="js/seasons.js"></script>
    <script src="js/love_timer.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/auth-ui.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const passwordInput = document.getElementById('passwordInput');
            const btnLogin = document.getElementById('btnLogin');
            const btnAccountLogin = document.getElementById('btnAccountLogin');
            const loginError = document.getElementById('loginError');
            const loginSection = document.getElementById('loginSection');
            const tocSection = document.getElementById('tocSection');
            const carouselTrack = document.getElementById('carouselTrack');

            // é…ç½® API åœ°å€ï¼ˆéƒ¨ç½²åéœ€è¦ä¿®æ”¹ä¸ºå®é™…çš„ Worker URLï¼‰
            authService.setApiUrl('https://love-story-api.gaolujie26.workers.dev');

            // --- CAROUSEL SETUP ---
            const images = [
                'image/cover.png', 'image/flowers.jpg', 'image/starbucks.jpg',
                'image/gallery_01.jpg', 'image/gallery_02.jpg', 'image/gallery_03.jpg',
                'image/gallery_04.jpg', 'image/gallery_05.jpg', 'image/gallery_06.jpg',
                'image/gallery_07.png', 'image/gallery_08.png'
            ];
            // Double the list for seamless loop
            const loopImages = [...images, ...images];

            loopImages.forEach(src => {
                const div = document.createElement('div');
                div.className = 'carousel-item';
                div.style.backgroundImage = `url('${src}')`;
                div.style.backgroundColor = '#eee';
                div.dataset.src = src;
                carouselTrack.appendChild(div);
            });

            const carouselContainer = document.querySelector('.carousel-container');
            const carouselPreview = document.getElementById('carouselPreview');
            const carouselPreviewImg = document.getElementById('carouselPreviewImg');

            let previewCloseTimer = null;

            function openPreview(src) {
                if (!carouselPreview || !carouselPreviewImg) return;
                if (previewCloseTimer) {
                    clearTimeout(previewCloseTimer);
                    previewCloseTimer = null;
                }
                carouselPreviewImg.src = src;
                carouselPreview.setAttribute('aria-hidden', 'false');
                carouselPreview.classList.add('show');
                if (carouselContainer) carouselContainer.classList.add('carousel-paused');
            }

            function closePreviewDelayed(delayMs = 160) {
                if (!carouselPreview) return;
                if (previewCloseTimer) clearTimeout(previewCloseTimer);
                previewCloseTimer = setTimeout(() => {
                    carouselPreview.classList.remove('show');
                    carouselPreview.setAttribute('aria-hidden', 'true');
                    if (carouselContainer) carouselContainer.classList.remove('carousel-paused');
                }, delayMs);
            }

            carouselTrack.addEventListener('mouseenter', (e) => {
                const item = e.target.closest('.carousel-item');
                if (!item) return;
                openPreview(item.dataset.src);
            }, true);

            carouselTrack.addEventListener('mouseleave', (e) => {
                const item = e.target.closest('.carousel-item');
                if (!item) return;
                closePreviewDelayed(180);
            }, true);

            carouselTrack.addEventListener('click', (e) => {
                const item = e.target.closest('.carousel-item');
                if (!item) return;
                openPreview(item.dataset.src);
            });

            if (carouselPreview) {
                carouselPreview.addEventListener('mouseenter', () => {
                    if (previewCloseTimer) {
                        clearTimeout(previewCloseTimer);
                        previewCloseTimer = null;
                    }
                });
                carouselPreview.addEventListener('mouseleave', () => closePreviewDelayed(80));
                carouselPreview.addEventListener('click', () => closePreviewDelayed(0));
            }

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') closePreviewDelayed(0);
            });


            // --- TIMER SETUP ---
            // Use the LoveTimer Class
            // Init for Login Page
            new LoveTimer('2025-11-05T18:25:00', 'loginTimer');
            // Init for Home Page
            new LoveTimer('2025-11-05T18:25:00', 'homeTimer');


            // --- LOGIN LOGIC ---

            // æ£€æŸ¥è´¦å·ç™»å½•çŠ¶æ€
            if (authService.isLoggedIn()) {
                showTOC(false);
            }
            // æ£€æŸ¥ç®¡ç†å‘˜å¯†ç ç™»å½•çŠ¶æ€
            else if (sessionStorage.getItem('isLoggedIn') === 'true') {
                showTOC(false);
            }

            function login() {
                if (passwordInput.value === '251105') {
                    sessionStorage.setItem('isLoggedIn', 'true');
                    showTOC(true);
                } else {
                    loginError.textContent = "å¯†ç é”™è¯¯ (Hint: 251105)";
                    passwordInput.classList.add('shake');
                    setTimeout(() => passwordInput.classList.remove('shake'), 500);
                }
            }

            function showTOC(animate) {
                if(animate) {
                    loginSection.style.opacity = '0';
                    loginSection.style.transition = 'opacity 0.5s';
                    setTimeout(() => {
                        loginSection.classList.add('hidden');
                        tocSection.classList.remove('hidden');
                    }, 500);
                } else {
                    loginSection.classList.add('hidden');
                    tocSection.classList.remove('hidden');
                }
            }

            btnLogin.addEventListener('click', login);
            passwordInput.addEventListener('keypress', (e) => {
                if(e.key === 'Enter') login();
            });

            // è´¦å·ç™»å½•æŒ‰é’®
            btnAccountLogin.addEventListener('click', () => {
                authUI.showLogin();
            });
        });
    </script>
</body>
</html>
