# 小羊工具归位小游戏

一个轻量、有趣、适合触屏与桌面端的拖拽匹配小游戏：把下方托盘中的“工具”拖到上方对应的“凹槽”中，限时完成即可通关。支持难度与关卡选择、主题切换、星级评分与奖励时间等玩法元素。

## 玩法说明

- 拖动下方的工具卡片，将其放入上方造型匹配的凹槽中。
- 全部工具正确归位且在倒计时结束前完成，即可通关。
- 关卡通关后会根据剩余时间给予星级和时间奖励；奖励时间会在后续关卡以一定比例转化为额外时间。
- 部分难度会加入“干扰工具”（没有对应凹槽）与“轻微/中等/剧烈”晃动增强挑战。

## 特色功能

- 4 档难度：新手 / 进阶 / 高手 / 地狱（晃动强度、工具数量、干扰元素随难度提升）
- 100 个关卡：全部解锁，可自由跳关体验
- 三种主题：牧场 / 儿童房 / 车库（随时切换）
- 星级与奖励时间：依据剩余时间计算星级与奖励，鼓励更快通关
- 触屏与鼠标友好：基于 Pointer Events 实现，移动端体验顺滑
- 轻量前端：纯 HTML + CSS + 原生 JS，无构建依赖，双击即可运行

## 在线/本地运行

- 直接双击 `index.html` 在浏览器中打开即可游玩。
- 或部署到任意静态网站托管服务（如 GitHub Pages）即可在线访问。

## 目录结构

```
love-story/
├─ index.html       # 页面结构
├─ css/
│  └─ style.css     # 视觉样式与动效
├─ js/
│  └─ main.js       # 游戏逻辑（关卡/计时/拖拽/结算等）
└─ image/           # 素材图片与图标
```

## 技术栈与实现要点

- 原生 JS：不依赖框架，使用 `Pointer Events` 统一处理鼠标/触摸
- 拖拽系统：
  - 启动时将元素绝对定位到 `body`，跟随指针移动
  - 松手时基于 `getBoundingClientRect` 进行重叠与精确匹配检测
  - 未匹配成功则回落到托盘中的当前位置（保持相对位置）
- 计时/星级/奖励：按剩余时间比例评星，并转换为后续关卡的额外时间
- 本地进度：使用 `localStorage` 存储关卡星级与奖励累计

## 已修复的已知问题

问题：匹配一次成功后，下一次拖拽容易“拉不动”或误进入其它点击界面。  
修复要点：

- 在拖拽开始时调用 `setPointerCapture`，在结束时 `releasePointerCapture`
- 监听 `pointercancel`，防止系统手势/滚动导致状态丢失
- `pointerdown/move` 中 `preventDefault()` 与 `stopPropagation()`，避免滚动/文本选中/冒泡点击
- 纠偏：失败回落时关闭柜体开合状态，统一恢复可交互性
- CSS 增强：为 `body/.game/.tools-tray/.tool` 添加 `user-select: none` 与 `-webkit-user-drag: none`

相关代码位置：`js/main.js` 的 `enableDrag` 函数与 `css/style.css` 的拖拽相关规则。

## 开发提示

- 调试重置：长按首页标题约 3 秒可清空本地进度与奖励时间。
- 可在 `DIFFS` 中调整每档难度的时间、工具数量、晃动强度与干扰数量。

## 版权

素材与代码用于学习与交流，若需商用请自检素材授权或替换为可商用资源。

